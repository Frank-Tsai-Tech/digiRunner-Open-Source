<app-container [title]="currentTitle" [isDefault]="pageNum==1" (headerReturn)="headerReturn()">
  <div [hidden]="pageNum != 1">
    <div class="form-group">
      <p-tabView class="tab" (onChange)="tabChange($event)">
        <p-tabPanel header="{{'keyword_search'|translate}}">
          <form [formGroup]="queryForm" (ngSubmit)="submitForm()">
            <div class="form-group row">
              <div class="col-8">
                <label for="keyword">{{ "keyword_search" | translate }}</label>
                <input type="text" class="form-control" id="keyword" formControlName="keyword" placeholder="{{ 'api_key' | translate }}、{{
                'module_name' | translate
              }}、{{ 'api_name' | translate }}、{{ 'api_desc' | translate }}" />
              </div>
              <div class="col-4">
                <label class="control-label">{{
                  "jwt_setting_req_resp" | translate
                  }}</label>
                <div>
                  <p-dropdown class="jwt-req-dropdown" [showClear]="false" [options]="queryJwtSettingFlags"
                    formControlName="queryJweFlag" [style]="{ width: '50%' }"></p-dropdown>
                  <p-dropdown class="jwt-resp-dropdown" [showClear]="false" [options]="queryJwtSettingFlags"
                    formControlName="queryJweFlagResp" [style]="{ width: '50%' }">
                  </p-dropdown>
                </div>
              </div>
            </div>
            <div class="form-group row">
              <div class="col-4 col-md-4 col-xl-4">
                <label class="control-label">{{ "api_src" | translate }}</label>
                <div formArrayName="apiSrc">
                  <div class="p-form-check-line">
                    <div class="p-form-check" *ngFor="let item of getControls(queryForm, 'apiSrc'); let j = index"
                      [formGroupName]="j">
                      <p-checkbox formControlName="selected" [value]="item.get('value').value"
                        inputId="apiSrc_{{j}}"></p-checkbox>
                      <label class="ml-2 mb-0" for="apiSrc_{{j}}">{{item.get("name").value}}</label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-4 col-md-4 col-xl-4">
                <label class="control-label">{{ "api_status" | translate }}</label>
                <div class="p-form-check-line form-group">
                  <ng-container *ngFor="let stat of apiStatusOpt">
                    <div class="p-form-check">
                      <p-radioButton formControlName="apiStatus" value={{stat.value}}
                        inputId="apiStatus{{stat.value}}"></p-radioButton>
                      <label for="apiStatus{{stat.value}}" class="ml-2 mb-0">{{stat.label}}</label>
                    </div>
                  </ng-container>
                </div>
              </div>
              <div class="col-4 col-md-4 col-xl-4">
                <label class="control-label">{{ "api_audience" | translate }}</label>
                <div class="p-form-check-line form-group">
                  <ng-container *ngFor="let stat of publicFlags">
                    <div class="p-form-check">
                      <p-radioButton formControlName="publicFlag" value={{stat.value}}
                        inputId="publicFlag{{stat.value}}"></p-radioButton>
                      <label for="publicFlag{{stat.value}}" class="ml-2 mb-0">{{stat.label}}</label>
                    </div>
                  </ng-container>
                </div>

              </div>
            </div>
            <hr />
            <div class="form-group row">
              <div class="col-12">
                <div style="
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
              ">
                  <button type="submit" class="btn tpi-btn tpi-primary text-center mr-2">
                    {{ "button.search" | translate }}
                  </button>
                </div>
              </div>
            </div>
          </form>
        </p-tabPanel>
        <p-tabPanel header="{{'button.searchByTags'|translate}}">
          <div class="form-group row">
            <div class="col-12">
              <label class="control-label">{{'labelList'|translate}}</label>
              <div style="display:block">
                <p-multiSelect #labelFilter [options]="lblList" [(ngModel)]="selLabelList" appendTo="body"
                  [emptyFilterMessage]="'no_data_result'|translate" defaultLabel="{{'plz_chs' | translate}}"
                  showClear="true" display="chip" [emptyMessage]="'no_data_result'|translate"
                  [style]="{'width':'100%'}">
                </p-multiSelect>
              </div>
            </div>
          </div>
          <div class="form-group row">
            <div style="
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
              ">
              <button type="button" class="btn tpi-btn tpi-primary text-center " (click)="queryLabelList()">
                {{ "button.search" | translate }}
              </button>
            </div>
          </div>


        </p-tabPanel>
      </p-tabView>
    </div>

    <!-- <div style="
        width: 100%;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #e0e0e0;
        margin-bottom: 20px;
        box-shadow: 0 2px 3px -1px rgba(0, 0, 0, 0.1);
      ">
      <div style="
          display: flex;
          width: 100%;
          align-items: center;
          justify-content: center;
        ">
        <div class="upload_reg_area" style="padding: 10px; cursor: pointer">
          <a [routerLink]="['/ac03/ac0318/']" routerLinkActive="router-link-active" [style]="{
              'text-decoration': 'none',
              display: 'flex',
              'align-items': 'center',
              color: '#4F4F4F'
            }"><img src="assets/images/vector.png" style="width: 16px; margin-right: 6.4px"
              alt="import_or_compose_api" />{{ "upload_reg_comp_api_file" | translate }}</a>
        </div>
      </div>
    </div> -->

    <p-overlayPanel #jwtSettingPanel [showCloseIcon]="true" [style]="{
        width: '450px',
        marginTop: '-70px',
        marginLeft: '-235px',
        backgroundColor: '#F49E00',
        'border-radius': '.25rem'
      }" (onShow)="showJwtSetting()">
      <form [formGroup]="queryForm">
        <div class="row">
          <div class="col-4">
            <label class="control-label">{{ "body_encode" | translate }}</label>
            <p-inputSwitch formControlName="jwtSetting" (onChange)="jwtSettingOnChange($event)">
            </p-inputSwitch>
          </div>
          <div class="col-8">
            <label class="control-label">Request</label>：
            <p-dropdown class="jwt-req-dropdown" [options]="updateJwtSettingFlags" formControlName="jweFlag"
              (onChange)="jweFlagOnChange($event)" [style]="{ width: '100%', 'background-color': '#ffa5009e' }">
            </p-dropdown>
            <label class="control-label">Response</label>：
            <p-dropdown class="jwt-resp-dropdown" [options]="updateJwtSettingFlags" formControlName="jweFlagResp"
              (onChange)="jweFlagRespOnChange($event)" [style]="{ width: '100%' }">
            </p-dropdown>
          </div>
        </div>
      </form>
    </p-overlayPanel>
    <p-table *ngIf="cols" [columns]="cols" [value]="dataList" [(selection)]="selected" styleClass="p-datatable-striped"
      [style]="{ 'word-break': 'break-word' }" responsiveLayout="scroll">
      <ng-template pTemplate="caption">
        <div class="field-flex-space-between">
          <div class="field-flex-center">
            <button type="button" class="btn tpi-primary tpi-btn" (click)="updateApiStatus('1')"
              [disabled]="selected.length == 0 || canStatusUpdate == false">
              {{ "button.enable" | translate }}
            </button>
            <button type="button" class="btn tpi-primary tpi-btn" (click)="updateApiStatus('2')"
              [disabled]="selected.length == 0 || canStatusUpdate == false">
              {{ "button.disable" | translate }}
            </button>
            <button type="button" *ngIf="canDelete" class="btn tpi-primary tpi-btn"
              (click)="updateApiStatus('0')" [disabled]="selected.length == 0">
              {{ "button.delete" | translate }}
            </button>
            <button type="button" *ngIf="canSetting" class="btn tpi-primary tpi-btn"
              (click)="jwtSettingPanel.toggle($event)" [disabled]="selected.length == 0">
              {{ "jwt_setting" | translate }}
            </button>
            <button type="button" *ngIf="canImport" title="{{ 'button.export_apiList_tooltip' | translate }}"
              class="btn tpi-primary tpi-btn" (click)="updateApiStatus('4')"
              [disabled]="selected.length == 0">
              {{ "button.export_reg_comp_api" | translate }}
            </button>
            <button type="button" *ngIf="canImport" title="{{ 'button.export_apiList_tooltip' | translate }}"
            class="btn tpi-primary tpi-btn" (click)="updateApiStatus('c')"
            [disabled]="selected.length == 0">
            {{ "apiStatus.cancelScheduledDate" | translate }}
          </button>
          </div>
        <div class="field-flex-center">

          <button type="button" *ngIf="canImport" title="{{ 'upload_reg_comp_api_file' | translate }}"
          class="btn tpi-primary tpi-btn mr-1" (click)="changePage('import')">
          {{ "upload_reg_comp_api_file" | translate }}
        </button>
        <p-menu styleClass="view-mode-menu" #menu [popup]="true" appendTo="body" [model]="ModeItems"></p-menu>
        <button type="button" class="tpi-btn btn tpi-primary" (click)="menu.toggle($event)">
          <!-- <button type="button" class="btn tpi-primary btn-icon" (click)="updateViewMode()"> -->
          <!-- {{ "view_mode" | translate }} {{viewMode+1}} -->
          <!-- 管理模式 -->
           <span *ngIf="viewMode=== 0">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7.1378 11.6515C9.277 11.6515 11.0169 9.91161 11.0169 7.77241C11.0169 5.63322 9.277 3.89334 7.1378 3.89334C4.99861 3.89334 3.25873 5.63322 3.25873 7.77241C3.25873 9.91161 4.99861 11.6515 7.1378 11.6515ZM7.1378 5.49952C8.39102 5.49952 9.41248 6.5192 9.41248 7.7742C9.41248 9.02919 8.3928 10.0489 7.1378 10.0489C5.88281 10.0489 4.86313 9.02919 4.86313 7.7742C4.86313 6.5192 5.88281 5.49952 7.1378 5.49952Z" fill="currentColor"/>
                <path d="M20.6522 15.076C21.0497 15.076 21.3866 14.7854 21.4455 14.3932L22.647 6.41224C22.6808 6.18049 22.6149 5.94697 22.4616 5.7687C22.3083 5.59222 22.0872 5.4906 21.8537 5.4906H13.2006C12.8031 5.4906 12.4662 5.78118 12.4073 6.17336L11.2058 14.1544C11.172 14.3861 11.2379 14.6196 11.3912 14.7979C11.5445 14.9744 11.7656 15.076 11.9991 15.076H15.8586V19.4578H14.8015C14.8122 19.4043 14.8175 19.3508 14.8175 19.2938V18.4399C14.8175 18.4399 14.8175 18.4274 14.8175 18.422C14.7712 16.4255 12.796 16.4504 11.6212 16.4647C11.0329 16.4718 10.4268 16.4789 10.0346 16.3399C9.75831 16.2418 9.46417 15.716 9.17895 15.2079C8.52827 14.0456 7.54424 12.2879 4.96829 12.2558C4.9576 12.2558 4.94868 12.2558 4.93799 12.2558C3.55999 12.2558 2.54565 13.4787 2.1499 14.6981C1.4921 16.7232 1.25857 19.0799 1.24966 19.1779C1.20687 19.6182 1.52954 20.0104 1.96985 20.0532C2.4173 20.0978 2.80236 19.7733 2.84514 19.333C2.84692 19.3098 3.07154 17.0494 3.67408 15.1936C3.888 14.5358 4.41745 13.8602 4.93799 13.8602C4.93977 13.8602 4.94334 13.8602 4.94512 13.8602C6.59408 13.8816 7.16988 14.9066 7.77777 15.9923C8.20739 16.7588 8.65128 17.5503 9.49269 17.8516C10.1558 18.0887 10.9099 18.078 11.639 18.0709C13.1828 18.0495 13.206 18.1939 13.2113 18.4524V19.2973C13.2113 19.3526 13.2167 19.4079 13.2274 19.4613H8.73685L6.50673 17.044C6.20546 16.7178 5.69919 16.6982 5.37296 16.9995C5.04673 17.3008 5.02712 17.807 5.32839 18.1333L7.72073 20.7252C7.86512 20.9303 8.104 21.0657 8.37496 21.0657H20.7431C21.187 21.0657 21.5453 20.7074 21.5453 20.2635C21.5453 19.8197 21.187 19.4613 20.7431 19.4613H17.4612V15.0796H20.6486L20.6522 15.076ZM13.8923 7.095H20.9214L19.9605 13.4716H12.9315L13.8923 7.095Z" fill="currentColor"/>
               </svg>
           </span>
          <!-- 稽核模式 -->
           <span *ngIf="viewMode=== 1">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12.0312 9.75296C14.3433 9.75296 16.2258 7.87225 16.2258 5.55835C16.2258 3.24445 14.3451 1.36374 12.0312 1.36374C9.71729 1.36374 7.83658 3.24445 7.83658 5.55835C7.83658 7.87225 9.71729 9.75296 12.0312 9.75296ZM12.0312 2.96992C13.4591 2.96992 14.6214 4.13222 14.6214 5.56013C14.6214 6.98804 13.4591 8.15034 12.0312 8.15034C10.6033 8.15034 9.44098 6.98804 9.44098 5.56013C9.44098 4.13222 10.6033 2.96992 12.0312 2.96992Z" fill="currentColor"/>
                <path d="M17.3863 10.6265L15.3933 9.83318C14.9815 9.66918 14.5144 9.87061 14.3504 10.2824C14.1864 10.6942 14.3879 11.1613 14.7997 11.3253L16.7909 12.1186C17.3025 12.3218 17.6323 12.8102 17.6323 13.3611V18.7108C17.6323 18.882 17.5432 18.9925 17.4897 19.0442C17.4362 19.0959 17.3186 19.1815 17.151 19.1725L13.2274 19.0264L12.935 18.0352L14.7694 18.1867C14.8121 18.1903 14.8531 18.1921 14.8959 18.1921C15.6785 18.1921 16.3488 17.5896 16.4165 16.7963L16.6358 14.2524C16.6732 13.8103 16.347 13.4217 15.9049 13.3842C15.4593 13.345 15.0742 13.673 15.0368 14.1151L14.8246 16.5823L12.7853 16.4148L13.9529 14.4931C14.1829 14.1151 14.0634 13.6213 13.6837 13.3914C13.3058 13.1614 12.812 13.2808 12.582 13.6606L11.951 14.6999L11.5927 13.4841C11.491 13.1436 11.1791 12.9083 10.8225 12.9083H8.53004L8.63165 12.6391C8.73683 12.361 8.94184 12.1399 9.21102 12.0152L9.99183 11.6533C10.3929 11.4661 10.5676 10.9901 10.3822 10.5872C10.195 10.1861 9.71908 10.0114 9.3162 10.1968L8.53539 10.5587C7.88293 10.8618 7.38379 11.3984 7.12887 12.0722L6.81334 12.9065H5.55656C5.30342 12.9065 5.06633 13.0259 4.9148 13.2292C4.76327 13.4324 4.71692 13.6944 4.78823 13.9369L5.97548 17.9568C5.92735 17.9746 5.881 17.9924 5.83465 18.0156C4.78823 18.5326 4.44952 19.9106 5.06276 21.1531C5.33729 21.7111 5.77226 22.1567 6.28567 22.4099C6.58872 22.5596 6.90603 22.6345 7.21622 22.6345C7.49788 22.6345 7.77241 22.5721 8.02377 22.4491C8.29295 22.3154 8.52291 22.1157 8.6994 21.8697H12.9956C13.2488 21.8697 13.4858 21.7503 13.6374 21.5471C13.7889 21.3438 13.8352 21.0818 13.7639 20.8393L13.7087 20.6486L17.0922 20.7752C17.1189 20.7752 17.1457 20.7752 17.1724 20.7752C17.709 20.7752 18.2153 20.5719 18.6039 20.1958C19.0121 19.8018 19.2367 19.2742 19.2367 18.7073V13.3575C19.2367 12.1453 18.5094 11.0739 17.3845 10.6247L17.3863 10.6265ZM7.44975 20.8126C7.4444 20.8286 7.44083 20.8447 7.43727 20.8607C7.41231 20.9196 7.37309 20.9802 7.31427 21.0087C7.20552 21.0622 7.05756 20.9998 6.99695 20.9713C6.80086 20.875 6.62081 20.6825 6.50315 20.4418C6.27319 19.9747 6.37658 19.5362 6.54594 19.4524C6.57624 19.4382 6.61011 19.431 6.64398 19.431C6.67607 19.431 6.70638 19.4364 6.73668 19.4435C6.75094 19.4489 6.7652 19.456 6.77947 19.4613C6.83651 19.4809 6.89177 19.5077 6.94525 19.5416C6.94525 19.5416 6.94704 19.5416 6.94882 19.5433C6.98625 19.5665 7.02369 19.5968 7.05756 19.6271C7.07717 19.6432 7.095 19.6592 7.11282 19.6788C7.12887 19.6949 7.14313 19.7109 7.15917 19.727C7.19126 19.7626 7.22157 19.7983 7.24831 19.8393C7.25544 19.85 7.26257 19.8607 7.2697 19.8714C7.3 19.9177 7.32853 19.9658 7.35527 20.0158C7.35527 20.0158 7.35527 20.0193 7.35705 20.0193C7.35705 20.0193 7.35705 20.0193 7.35705 20.0211C7.38201 20.0728 7.4034 20.1263 7.42122 20.1798C7.42479 20.1922 7.43014 20.2029 7.4337 20.2154C7.44796 20.26 7.45866 20.3063 7.46757 20.3509C7.47292 20.3759 7.47649 20.399 7.48005 20.424C7.48184 20.4418 7.48362 20.4579 7.48362 20.4739C7.49253 20.5951 7.48362 20.711 7.44796 20.8126H7.44975ZM9.07732 20.2635C9.06841 20.1833 9.05593 20.1031 9.03988 20.0229C9.03988 20.0229 9.03988 20.0211 9.03988 20.0193C9.02562 19.9462 9.0078 19.8731 8.9864 19.8018C8.98284 19.7929 8.98106 19.7822 8.97927 19.7733C8.95966 19.7091 8.93827 19.6432 8.91331 19.579C8.90797 19.5647 8.9044 19.5505 8.89727 19.5362C8.86696 19.4613 8.83488 19.3865 8.79922 19.3134C8.79922 19.3134 8.79922 19.3116 8.79922 19.3098C8.79922 19.3098 8.79922 19.308 8.79744 19.3062C8.76535 19.2421 8.73148 19.1779 8.69405 19.1173C8.67622 19.087 8.65483 19.0567 8.637 19.0264C8.61739 18.9961 8.59957 18.9658 8.57996 18.9372C8.55143 18.8962 8.52291 18.857 8.49261 18.8196C8.48013 18.8035 8.46943 18.7875 8.45695 18.7714C8.41952 18.7251 8.3803 18.6805 8.34108 18.6377C8.33573 18.6324 8.33038 18.6253 8.32504 18.6199C8.14142 18.4203 7.93107 18.2527 7.70467 18.1226L6.63864 14.5109H10.2307L11.9278 20.2635H9.08267H9.07732Z" fill="currentColor"/>
               </svg>
           </span>
           <span class="ml-2">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M1.46967 3.96967C1.76256 3.67678 2.23744 3.67678 2.53033 3.96967L7 8.43934L11.4697 3.96967C11.7626 3.67678 12.2374 3.67678 12.5303 3.96967C12.8232 4.26256 12.8232 4.73744 12.5303 5.03033L7.53033 10.0303C7.23744 10.3232 6.76256 10.3232 6.46967 10.0303L1.46967 5.03033C1.17678 4.73744 1.17678 4.26256 1.46967 3.96967Z" fill="currentColor"/>
              </svg>
           </span>
        </button>
        </div>
        </div>
      </ng-template>
      <!-- <ng-template pTemplate="colgroup" let-columns>
        <colgroup>
          <col style="width: 2.25em" />

          <col *ngFor="let col of columns" [ngStyle]="{
              width: col.field === 'apiStatus' ? '70px' : 'inherit'
            }" />
        </colgroup>
        <colgroup style="width: 130px">
          {{
          "action" | translate
          }}
        </colgroup>
      </ng-template> -->
      <ng-template pTemplate="header" let-columns selectionMode="multiple">
        <tr style="text-align: center">
          <th style="width: 2.25em" scope="col">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th style="width: 50px" scope="col">{{'status'|translate}}</th>
          <th scope="col" (click)="changeSort('apiName')" pSortableColumn="apiName">{{'api_name'|translate}}<p-sortIcon
              field="apiKey"></p-sortIcon></th>
          <th *ngIf="viewModeList[viewMode].includes('apiDesc')" scope="col">{{'api_desc'|translate}}</th>
          <th *ngIf="viewModeList[viewMode].includes('moduleName')" scope="col" (click)="changeSort('moduleName')" pSortableColumn="moduleName">
            {{'moduleName'|translate}}<p-sortIcon field="moduleName"></p-sortIcon></th>
          <th *ngIf="viewModeList[viewMode].includes('apiKey')" scope="col" (click)="changeSort('apiKey')" pSortableColumn="apiKey">{{'api_key'|translate}}<p-sortIcon
              field="apiKey"></p-sortIcon></th>
          <th *ngIf="viewModeList[viewMode].includes('apiSrc')" scope="col" (click)="changeSort('apiSrc')" pSortableColumn="apiSrc">{{'api_src'|translate}}<p-sortIcon
              field="apiSrc"></p-sortIcon></th>
          <th *ngIf="viewModeList[viewMode].includes('JWTnLabel')" scope="col">{{'jwt_setting'|translate}}/{{'label_tag'|translate}}</th>
          <th *ngIf="viewModeList[viewMode].includes('enableScheduledDate')" scope="col">{{'apiStatus.scheduledLaunchDate'|translate}}</th>
          <th *ngIf="viewModeList[viewMode].includes('disableScheduledDate')" scope="col"> {{'apiStatus.scheduledDiscontinuationDate'|translate}}</th>
          <th *ngIf="viewModeList[viewMode].includes('org')" scope="col">{{'org_name'|translate}}</th>
          <th *ngIf="viewModeList[viewMode].includes('createUser')" scope="col">{{'create_user'|translate}}</th>
          <th *ngIf="viewModeList[viewMode].includes('createDate')" scope="col">{{'create_time'|translate}}</th>
          <th *ngIf="viewModeList[viewMode].includes('updateUser')" scope="col" (click)="changeSort(col)">{{'update_user'|translate}}</th>
          <th scope="col" (click)="changeSort(col)">{{'update_time'|translate}}</th>
          <!-- <th *ngFor="let col of columns" scope="col" [pSortableColumn]="col.field" [ngStyle]="{
              width: col.field === 'apiStatus' ? '70px' : 'inherit',
              whiteSpace: col.field === 'apiStatus' ? 'nowrap' : 'inherit'
            }" (click)="changeSort(col)"
            >
            {{ col.header }}
            <p-sortIcon *ngIf="
                col.field === 'apiKey' ||
                col.field === 'apiSrc' ||
                col.field === 'moduleName' ||
                col.field === 'apiName'
              " [field]="col.field"></p-sortIcon>
          </th> -->
          <th style="width: 110px" scope="col">{{ "action" | translate }}</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowData let-columns="columns">
        <!-- [pSelectableRow]="rowData" 控制高亮 -->
        <tr>
          <td>
            <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
          </td>

          <td style="text-align: center;">
            <img alt="status" style="width: 20px; height: 20px" [src]="stat.transform(rowData.apiStatus.v)" />
          </td>
          <td>
            <a href="javascript:void(0)" (click)="changePage('detail', rowData)">
              {{ rowData['apiName'].ori ? rowData['apiName'].ori : rowData['apiName'].val }}
            </a>
          </td>
          <td *ngIf="viewModeList[viewMode].includes('apiDesc')">
            <span>
              {{ originStringTable(rowData['apiDesc']) }}
              <label class="moreless" *ngIf="rowData['apiDesc']?.ori" (click)="switchOri(rowData['apiDesc'])">
                {{rowData['apiDesc'].t ? ("show_more" | translate): '' }}
                <i class="fas"
                  [ngClass]="[rowData['apiDesc'].t ?  'fa-angle-double-right mt-1' : 'fa-angle-double-left  mt-1 mr-1']"></i>
                {{rowData['apiDesc'].t ? '' : ("show_less" | translate) }}
              </label>
            </span>
          </td>
          <td *ngIf="viewModeList[viewMode].includes('moduleName')" >
            <span>
              {{ originStringTable(rowData['moduleName']) }}
              <label class="moreless" *ngIf="rowData['moduleName'].ori" (click)="switchOri(rowData['moduleName'])">
                {{rowData['moduleName'].t ? ("show_more" | translate): '' }}
                <i class="fas"
                  [ngClass]="[rowData['moduleName'].t ?  'fa-angle-double-right mt-1' : 'fa-angle-double-left  mt-1 mr-1']"></i>
                {{rowData['moduleName'].t ? '' : ("show_less" | translate) }}
              </label>
            </span>
          </td>
          <td *ngIf="viewModeList[viewMode].includes('apiKey')">
            {{ rowData['apiKey'].ori ? rowData['apiKey'].ori : rowData['apiKey'].val }}
          </td>
          <td *ngIf="viewModeList[viewMode].includes('apiSrc')">
            {{ rowData['apiSrc'].n }}
          </td>

          <td *ngIf="viewModeList[viewMode].includes('JWTnLabel')">
            <span>
              <img *ngIf="rowData['jweFlag'].v == '1'" src="assets/images/jwe_req_flag.png" alt="JWE" />
              <img *ngIf="rowData['jweFlag'].v == '2'" src="assets/images/jws_req_flag.png" alt="JWS" />
              <img *ngIf="rowData['jweFlagResp'].v == '1'" src="assets/images/jwe_resp_flag.png" alt="JWE" />
              <img *ngIf="rowData['jweFlagResp'].v == '2'" src="assets/images/jws_resp_flag.png" alt="JWS" />
              <label *ngFor="let item of rowData['labelList']; let idx = index;"
                style="background-color: #666666;color: #fff; border-radius: 5px;" class="m-1 p-1">
                {{item}}

              </label>
            </span>
          </td>
          <td *ngIf="viewModeList[viewMode].includes('enableScheduledDate')">
            <span>
              <app-api-status [type]="'enableScheduledDate'" [rowData]="rowData"
                (click)="modifyApiStatus(rowData,'enableScheduledDate')"></app-api-status>
            </span>
          </td>
          <td *ngIf="viewModeList[viewMode].includes('disableScheduledDate')">
            <span>
              <app-api-status [type]="'disableScheduledDate'" [rowData]="rowData"
                (click)="modifyApiStatus(rowData,'disableScheduledDate')"></app-api-status>
            </span>
          </td>
          <td *ngIf="viewModeList[viewMode].includes('org')">
            {{rowData?.org?.n}}
          </td>
          <td *ngIf="viewModeList[viewMode].includes('createUser')">
            {{rowData?.createUser}}
          </td>
          <td *ngIf="viewModeList[viewMode].includes('createDate')">
            {{rowData?.createDate}}
          </td>
          <td *ngIf="viewModeList[viewMode].includes('updateUser')" >
            {{rowData?.updateUser}}
          </td>
          <td>
            {{rowData?.updateDate}}
          </td>
          <!-- <td *ngFor="let col of columns" [ngStyle]="{ width: col.field === 'apiStatus' ? '70px' : 'auto' }">
            <img *ngIf="col.field === 'apiStatus'" alt="status" style="width: 20px; height: 20px"
              [src]="col.type.transform(rowData[col.field].v)" />
            <span *ngIf="col.field === 'apiKey'">
              {{ rowData[col.field].ori ? rowData[col.field].ori : rowData[col.field].val }}
            </span>
            <span *ngIf="col.field == 'apiName'">
              <a href="javascript:void(0)" (click)="changePage('detail', rowData)">
                {{ rowData[col.field].ori ? rowData[col.field].ori : rowData[col.field].val }}
              </a>
            </span>
            <span *ngIf="col.field == 'apiSrc'">
              {{ rowData[col.field].n }}
            </span>
            <span *ngIf="col.field == 'moduleName'">
              {{ originStringTable(rowData[col.field]) }}
              <label class="moreless" *ngIf="rowData[col.field].ori" (click)="switchOri(rowData[col.field])">
                {{rowData[col.field].t ? ("show_more" | translate): '' }}
                <i class="fas"
                  [ngClass]="[rowData[col.field].t ?  'fa-angle-double-right mt-1' : 'fa-angle-double-left  mt-1 mr-1']"></i>
                {{rowData[col.field].t ? '' : ("show_less" | translate) }}
              </label>
            </span>
            <span *ngIf="col.field == 'apiDesc' && rowData['apiDesc']">
              {{ originStringTable(rowData[col.field]) }}
              <label class="moreless" *ngIf="rowData[col.field].ori" (click)="switchOri(rowData[col.field])">
                {{rowData[col.field].t ? ("show_more" | translate): '' }}
                <i class="fas"
                  [ngClass]="[rowData[col.field].t ?  'fa-angle-double-right mt-1' : 'fa-angle-double-left  mt-1 mr-1']"></i>
                {{rowData[col.field].t ? '' : ("show_less" | translate) }}
              </label>
            </span>
            <span *ngIf="col.field == 'jweFlag'">
              <img *ngIf="rowData['jweFlag'].v == '1'" src="assets/images/jwe_req_flag.png" alt="JWE" />
              <img *ngIf="rowData['jweFlag'].v == '2'" src="assets/images/jws_req_flag.png" alt="JWS" />
              <img *ngIf="rowData['jweFlagResp'].v == '1'" src="assets/images/jwe_resp_flag.png" alt="JWE" />
              <img *ngIf="rowData['jweFlagResp'].v == '2'" src="assets/images/jws_resp_flag.png" alt="JWS" />
              <label *ngFor="let item of rowData['labelList']; let idx = index;"
                style="background-color: #666666;color: #fff; border-radius: 5px;" class="m-1 p-1">
                {{item}}

              </label>
            </span>



            <span *ngIf="col.field == 'updateTime'">
              {{ rowData[col.field] }}
            </span>
           API啟用停用日期狀態
            <span *ngIf="col.field == 'enableScheduledDate' || col.field == 'disableScheduledDate'">
              <app-api-status [type]="col.field" [rowData]="rowData"
                (click)="modifyApiStatus(rowData,col.field)"></app-api-status>
            </span>
          </td> -->
          <td style="text-align: center; width: 110px">
            <div style="
                display: flex;
                align-items: center;
                justify-content: space-between;
              ">


              <button pButton pRipple type="button" icon="pi pi-eye"
                class="p-button-rounded p-button-text p-button-plain" (click)="changePage('detail', rowData)"
                [pTooltip]="'button.detail' | translate" tooltipPosition="top"></button>


              <button pButton pRipple type="button" icon="fa fa-edit"
                class="p-button-rounded p-button-text p-button-plain" (click)="changePage('update', rowData)"
                [pTooltip]="'button.update' | translate" tooltipPosition="top"></button>

              <button pButton pRipple type="button" icon="pi pi-credit-card"
                class="p-button-rounded p-button-text p-button-plain"
                (click)="showDialog(rowData, formOperate.test, 'win')" [pTooltip]="'button.test' | translate"
                tooltipPosition="top" [disabled]="canAPITest == false"></button>

              <button pButton pRipple type="button" icon="fa fa-file-code "
                class="p-button-rounded p-button-text p-button-plain" *ngIf="rowData.apiSrc.v=='C'"
                (click)="changePage('swagger',rowData)" [pTooltip]="'Swagger' | translate" tooltipPosition="top"
                [disabled]="canAPITest == false"></button>

            </div>

          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="footer" let-columns>
        <tr *ngIf="dataList.length > 0">
          <td [attr.colspan]="viewModeList[viewMode].length+5" style="color: #b7b7b7;">
            {{ "row_count" | translate }}: {{ dataList.length }}
            <!-- <button type="button" class="btn btn-warning pull-right ml-3" (click)="moreApiListData()">
              {{ "button.more" | translate }}</button> -->

            <!-- 查詢更多 -->
            <button type="button" icon="" class="btn tpi-header-return" (click)="moreApiListData()">
              {{ 'button.more'| translate}}
              <i class="fas fa-angle-double-right" style="margin-left: 5px;"></i>
            </button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage" let-columns>
        <tr>
          <td [attr.colspan]="13">
            {{ "no_rec" | translate }}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
  <!-- API詳細資料 -->
  <div *ngIf="pageNum==2">
    <app-api-detail [apiDetail]="apiDetail" [srcUrlPool]="srcUrlPool" [ipSrcUrl]="ipSrcUrl" [apiGroupList]="apiGroupList"
      [detailCols]="detailCols" (getApiGroupListEvt)="getApiGroupListEvt($event)"></app-api-detail>
    <div class="form-group row">
      <div class="col-12">
        <button type="button" class="btn tpi-btn tpi-primary float-left" (click)="changePage('query')">
          {{ "button.return_to_list" | translate }}
        </button>
      </div>
    </div>
  </div>
  <!-- 更新API資訊 -->
  <div *ngIf="pageNum == 3">
    <form [formGroup]="updateForm">
      <div class="form-group row">
        <div class="col-sm-6">
          <label id="moduleName_label" class="control-label">[{{ "module_id" | translate }}]
            {{ "module_name" | translate }}</label>
          <label class="form-control border-line">
            [{{ apiDetail.moduleId }}] {{ apiDetail.moduleName.o && !apiDetail.moduleName.t ? apiDetail.moduleName.o :
            apiDetail.moduleName.v}}
            <!-- <a *ngIf="apiDetail.moduleName.t == true" href="javascript:void(0)" pTooltip="{{ apiDetail.moduleName.o }}"
              (click)="copyData(apiDetail.moduleName.o)">...{{ "show_more" | translate }}</a> -->
            <label class="moreless" *ngIf="apiDetail.moduleName.o" (click)="switchOri(apiDetail.moduleName)">
              {{apiDetail.moduleName.t ? ("show_more" | translate): '' }}
              <i class="fas"
                [ngClass]="[apiDetail.moduleName.t ?  'fa-angle-double-right mt-1' : 'fa-angle-double-left  mt-1 mr-1']"></i>
              {{apiDetail.moduleName.t ? '' : ("show_less" | translate) }}
            </label>
          </label>
        </div>
        <div class="col-sm-2" *ngIf="apiDetail.apiSrc.v == 'R' || apiDetail.apiSrc.v == 'C'">
          <label id="apiStatus_label" class="control-label"> API Cache </label>
          <p-dropdown [options]="apiCacheFlags" formControlName="apiCacheFlag" [style]="{ width: '100%' }"></p-dropdown>
        </div>
        <div class="col-sm-4">
          <label id="apiKey_label" class="control-label">{{
            "api_key" | translate
            }}</label>
          <label class="form-control border-line">
            {{ apiDetail.apiKey.o && !apiDetail.apiKey.t ? apiDetail.apiKey.o : apiDetail.apiKey.v}}
            <!-- <a *ngIf="apiDetail.apiKey.t == true" href="javascript:void(0)" pTooltip="{{ apiDetail.apiKey.o }}"
              (click)="copyData(apiDetail.apiKey.o)">...{{ "show_more" | translate }}</a> -->
            <label class="moreless" *ngIf="apiDetail.apiKey.o" (click)="switchOri(apiDetail.apiKey)">
              {{apiDetail.apiKey.t ? ("show_more" | translate): '' }}
              <i class="fas"
                [ngClass]="[apiDetail.apiKey.t ?  'fa-angle-double-right mt-1' : 'fa-angle-double-left  mt-1 mr-1']"></i>
              {{apiDetail.apiKey.t ? '' : ("show_less" | translate) }}
            </label>
          </label>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-sm-6">
          <label id="apiName_label" class="control-label">{{
            "api_name" | translate
            }}</label>
          <input type="text" class="form-control" formControlName="apiName"
            placeholder="{{ 'api_name' | translate }}" />
          <div *ngIf="u_apiName.invalid && (u_apiName.dirty || u_apiName.touched)" class="text-danger">
            <small class="form-text">{{ u_apiName.errors.isRequired }}</small>
            <small class="form-text">{{
              u_apiName.errors.maxlength | translate
              }}</small>
            <small class="form-text">{{
              u_apiName.errors.minlength | translate
              }}</small>
            <small class="form-text">{{ u_apiName.errors.pattern }}</small>
          </div>
        </div>
        <!-- 固定快取時間 -->
        <div class="col-sm-2">
          <label id="fixedCacheTime_label" class="control-label required">{{"fixed_cache_time" | translate}}({{
            'minute'|translate }})</label><i class="far fa-question-circle ml-2 "
            pTooltip="{{'fixed_cache_time_tip'|translate}}" [escape]="false"></i>
          <input id="fixedCacheTime" type="number" min="0" class="form-control" formControlName="fixedCacheTime"
            placeholder="{{ 'fixed_cache_time' | translate }}" />
          <div *ngIf="fixedCacheTime.invalid && (fixedCacheTime.dirty || fixedCacheTime.touched)" class="text-danger">
            <small class="form-text">{{ fixedCacheTime.errors.isRequired }}</small>
          </div>
        </div>


        <div class="col-sm-4">
          <label class="control-label">
            {{ "jwt_setting" | translate }}
          </label>
          <p-inputSwitch formControlName="jwtSetting" (onChange)="jwtSettingOnChange($event)">
          </p-inputSwitch>
          <div class="row">
            <div class="col-sm-12">
              <label id="jweFlag_label" class="control-label">Request：</label>
              <p-dropdown [options]="updateJwtSettingFlags" formControlName="jweFlag"
                (onChange)="jweFlagOnChange($event)" [style]="{ width: '80%' }">
              </p-dropdown>
              <div *ngIf="
                  u_jweFlag.invalid && (u_jweFlag.dirty || u_jweFlag.touched)
                " class="text-danger">
                <small class="form-text">{{
                  u_jweFlag.errors.isRequired
                  }}</small>
                <small class="form-text">{{
                  u_jweFlag.errors.maxlength | translate
                  }}</small>
                <small class="form-text">{{
                  u_jweFlag.errors.minlength | translate
                  }}</small>
                <small class="form-text">{{ u_jweFlag.errors.pattern }}</small>
              </div>
            </div>
            <div class="col-sm-12">
              <label id="jweFlagResp_label" class="control-label">Response：</label>
              <p-dropdown [options]="updateJwtSettingFlags" formControlName="jweFlagResp"
                (onChange)="jweFlagRespOnChange($event)" [style]="{ width: '80%' }">
              </p-dropdown>
              <div *ngIf="
                  u_jweFlagResp.invalid &&
                  (u_jweFlagResp.dirty || u_jweFlagResp.touched)
                " class="text-danger">
                <small class="form-text">{{
                  u_jweFlagResp.errors.isRequired
                  }}</small>
                <small class="form-text">{{
                  u_jweFlagResp.errors.maxlength | translate
                  }}</small>
                <small class="form-text">{{
                  u_jweFlagResp.errors.minlength | translate
                  }}</small>
                <small class="form-text">{{
                  u_jweFlagResp.errors.pattern
                  }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="apiDetail.apiSrc.v == 'R' || apiDetail.apiSrc.v == 'C'" class="form-group row">

        <div class="col-sm-2">
          <label class="control-label required">{{ "http_method" | translate }}</label>
          <div style="display: block">

            <p-multiSelect [options]="methodOfJsons" formControlName="methodOfJson"
              defaultLabel="{{ 'plz_chs' | translate }}" [style]="{ width: '100%' }"
              [hidden]="apiDetail.apiSrc.v==='C'">
            </p-multiSelect>
            <p-dropdown [options]="methodOfJsons" formControlName="methodOfJson" [hidden]="apiDetail.apiSrc.v!=='C'"
              defaultLabel="{{ 'plz_chs' | translate }}" [style]="{ width: '100%' }"></p-dropdown>
          </div>
        </div>
        <div class="col-sm-4">
          <div>
            <label class="w-100" style="
                font-weight: bolder;
                font-family: PingFangSC-Regular, sans-serif;
                font-size: 16px;
                color: #5a5541;
              ">{{ "data_format" | translate }}</label>
            <!-- <label id="reghostId_label" class="w-50" style="
                font-weight: bolder;
                font-family: PingFangSC-Regular, sans-serif;
                font-size: 16px;
                color: #5a5541;
              ">{{ "reg_host" | translate }}</label> -->
          </div>
          <div>
            <p-dropdown [showClear]="false" [options]="dataFormats" formControlName="dataFormat"
              placeholder="{{ 'plz_chs' | translate }}" [style]="{ width: '100%' }">
            </p-dropdown>
            <!-- <p-dropdown [showClear]="true" [options]="reghostIds" formControlName="reghostId"
              placeholder="{{ 'plz_chs' | translate }}" [style]="{ width: '50%' }"></p-dropdown> -->
          </div>
          <!-- <div *ngIf="
              u_regHostId.invalid && (u_regHostId.dirty || u_regHostId.touched)
            " class="text-danger">
            <small class="form-text">{{ u_regHostId.errors.isRequired }}</small>
            <small class="form-text">{{
              u_regHostId.errors.maxlength | translate
              }}</small>
            <small class="form-text">{{
              u_regHostId.errors.minlength | translate
              }}</small>
            <small class="form-text">{{ u_regHostId.errors.pattern }}</small>
          </div> -->
        </div>
        <div class="col-sm-2">
          <label id="apiStatus_label" class="control-label">{{"api_status" | translate}}</label>
          <p-inputSwitch class="form-control border-line" formControlName="apiStatus"></p-inputSwitch>
          <div *ngIf="
              u_apiStatus.invalid && (u_apiStatus.dirty || u_apiStatus.touched)
            " class="text-danger">
            <small class="form-text">{{ u_apiStatus.errors.isRequired }}</small>
            <small class="form-text">{{
              u_apiStatus.errors.maxlength | translate
              }}</small>
            <small class="form-text">{{
              u_apiStatus.errors.minlength | translate
              }}</small>
            <small class="form-text">{{ u_apiStatus.errors.pattern }}</small>
          </div>
        </div>
      </div>

      <div *ngIf="apiDetail.apiSrc.v == 'R' || apiDetail.apiSrc.v == 'C'" class="form-group row">
        <div class="col-12">
          <div class="row col-12 pr-0" style="justify-content: space-between;">

            <div class="col-4 px-0">
              <label id="srcUrl_label " class="control-label required" style="padding-left: 1px">{{ "tar_url" |
                translate}}</label>
            </div>


            <div class="col-8 row pr-0" style="justify-content: end;">
              <div class="mr-3">
                <!-- <input type="checkbox" formControlName="urlRID" [hidden]="apiDetail.pathType =='dgrc'" id="urlRID"
                  class="mr-1" /> -->
                <p-checkbox [binary]="true" inputId="urlRID" formControlName="urlRID"
                  [hidden]="apiDetail.pathType =='dgrc'"> </p-checkbox>
                <label class="mb-0 ml-1" for="urlRID">{{apiDetail.pathType =='dgrc'? '': "path_param" | translate
                  }}</label>
              </div>
              <div>
                <!-- <input type="checkbox" formControlName="noOAuth" id="noOAuth" /> -->
                <p-checkbox [binary]="true" inputId="noOAuth" formControlName="noOAuth"> </p-checkbox>
                <label class="mb-0 ml-1" for="noOAuth">{{"no_auth" | translate}}</label>
              </div>
            </div>
          </div>
          <div class="form-group" *ngIf="apiDetail.apiSrc.v =='R' && apiDetail.type == '1'">
            <p-checkbox [binary]="true" inputId="redirectByIp" formControlName="redirectByIp"> </p-checkbox>
            <label class="mb-0 ml-1" for="redirectByIp">{{'diversionSrcIP'|translate}}</label>
          </div>

          <div [hidden]="redirectByIp.value">
            <app-src-url-input formControlName="srcUrl" [_disabled]="apiDetail.apiSrc.v == 'C'"></app-src-url-input>
          </div>
          <div [hidden]="!redirectByIp.value">
            <!-- <app-source-ip-config></app-source-ip-config> -->
            <app-source-ip-form formControlName="redirectByIpDataList"></app-source-ip-form>
          </div>

          <div *ngIf="
              u_protocol.invalid && (u_protocol.dirty || u_protocol.touched)
            " class="text-danger">
            <small class="form-text">{{ u_protocol.errors.isRequired }}</small>
            <small class="form-text">{{
              u_protocol.errors.maxlength | translate
              }}</small>
            <small class="form-text">{{
              u_protocol.errors.minlength | translate
              }}</small>
            <small class="form-text">{{ u_protocol.errors.pattern }}</small>
          </div>
          <div *ngIf="u_srcUrl.invalid && (u_srcUrl.dirty || u_srcUrl.touched)" class="text-danger">
            <small class="form-text">{{ u_srcUrl.errors.isRequired }}</small>
            <small class="form-text">{{
              u_srcUrl.errors.maxlength | translate
              }}</small>
            <small class="form-text">{{
              u_srcUrl.errors.minlength | translate
              }}</small>
            <small class="form-text">{{ u_srcUrl.errors.pattern }}</small>
          </div>
        </div>
      </div>

      <div class="form-group row" *ngIf="apiDetail.apiSrc.v !='C'">
        <div class="col-12">
          <label id="headerMask_label" class="control-label">API Log Header Mask</label>

          <div class="col-12 form-group ">
            <div class="p-form-check mb-2">
              <p-radioButton formControlName="headerMaskPolicy" value="0" inputId="headerMaskPolicy0"></p-radioButton>
              <label for="headerMaskPolicy0" class="ml-2 mb-0">Policy 0: {{'mask.none'|translate}}</label>
              <!-- <input type="radio" id="headerMaskPolicy0" class="form-check-input" value="0"
                formControlName="headerMaskPolicy" />
              <label class="form-check-label" for="headerMaskPolicy0">Policy 0: {{'mask.none'|translate}}</label> -->
            </div>
            <div class="p-form-check mb-2">
              <p-radioButton formControlName="headerMaskPolicy" value="1" inputId="headerMaskPolicy1"></p-radioButton>
              <label for="headerMaskPolicy1" class="ml-2 mb-0">Policy 1: {{
                'mask.before_after'|translate:{num:(headerMaskPolicyNum.value?headerMaskPolicyNum.value:'1'),
                mask:(headerMaskPolicySymbol.value?headerMaskPolicySymbol.value:'*') }
                }}</label>
              <!-- <input type="radio" id="headerMaskPolicy1" class="form-check-input" value="1"
                formControlName="headerMaskPolicy" />
              <label class="form-check-label" for="headerMaskPolicy1">Policy 1: {{
                'mask.before_after'|translate:{num:(headerMaskPolicyNum.value?headerMaskPolicyNum.value:'1'),
                mask:(headerMaskPolicySymbol.value?headerMaskPolicySymbol.value:'*') }
                }}</label> -->
            </div>
            <div class="p-form-check mb-2">
              <p-radioButton formControlName="headerMaskPolicy" value="2" inputId="headerMaskPolicy2"></p-radioButton>
              <label for="headerMaskPolicy2" class="ml-2 mb-0">Policy 2: {{
                'mask.before'|translate:{num:(headerMaskPolicyNum.value?headerMaskPolicyNum.value:'1'),
                mask:(headerMaskPolicySymbol.value?headerMaskPolicySymbol.value:'*') } }}</label>
              <!-- <input type="radio" id="headerMaskPolicy2" class="form-check-input" value="2"
                formControlName="headerMaskPolicy" />
              <label class="form-check-label" for="headerMaskPolicy2">Policy 2: {{
                'mask.before'|translate:{num:(headerMaskPolicyNum.value?headerMaskPolicyNum.value:'1'),
                mask:(headerMaskPolicySymbol.value?headerMaskPolicySymbol.value:'*') } }}</label> -->
            </div>
            <div class="p-form-check">
              <p-radioButton formControlName="headerMaskPolicy" value="3" inputId="headerMaskPolicy3"></p-radioButton>
              <label for="headerMaskPolicy3" class="ml-2 mb-0">Policy 3: {{
                'mask.after'|translate:{num:(headerMaskPolicyNum.value?headerMaskPolicyNum.value:'1'),
                mask:(headerMaskPolicySymbol.value?headerMaskPolicySymbol.value:'*') } }}</label>
              <!-- <input type="radio" id="headerMaskPolicy3" class="form-check-input" value="3"
                formControlName="headerMaskPolicy" />
              <label class="form-check-label" for="headerMaskPolicy3">Policy 3: {{
                'mask.after'|translate:{num:(headerMaskPolicyNum.value?headerMaskPolicyNum.value:'1'),
                mask:(headerMaskPolicySymbol.value?headerMaskPolicySymbol.value:'*') } }}</label> -->
            </div>
            <div class="mt-1"
              *ngIf="headerMaskPolicy.value == '1'||headerMaskPolicy.value == '2'||headerMaskPolicy.value == '3'">
              <label class="control-label required mr-1" style="font-weight: 400;">{{ 'mask.word'|translate}}</label>
              <input type="number" [min]="1" [max]="9999" class="form-control mr-2"
                formControlName="headerMaskPolicyNum" style="display: inline;width: 75px;" />
              <label class="control-label required mr-1">{{ 'mask.mask'|translate}}</label> <input type="text"
                class="form-control" formControlName="headerMaskPolicySymbol" style="display: inline;width: 100px;"
                [maxlength]="10" [minlength]="1" (focusout)="checkheaderMaskPolicySymbol()" />
            </div>

          </div>

          <div class="col-12"
            *ngIf="headerMaskPolicy.value == '1'||headerMaskPolicy.value == '2'||headerMaskPolicy.value == '3'">
            <app-fields-form formControlName="headerMaskKey" [headerPolicy]="headerMaskPolicy.value"
              [headerPolicyNum]="headerMaskPolicyNum.value"
              [headerPolicyMask]="headerMaskPolicySymbol.value"></app-fields-form>
          </div>

        </div>
      </div>

      <div class="form-group row" *ngIf="apiDetail.apiSrc.v !='C'">
        <div class="col-12">
          <label id="headerMask_label" class="control-label">API Log Body Mask Policy</label>
          <div class="col-12 form-group ">
            <div class="p-form-check mb-2">
              <p-radioButton formControlName="bodyMaskPolicy" value="0" inputId="bodyMaskPolicy0"></p-radioButton>
              <label for="bodyMaskPolicy0" class="ml-2 mb-0">Policy 0: {{'mask.none'|translate}}</label>
              <!-- <input type="radio" id="bodyMaskPolicy0" class="form-check-input" value="0"
                formControlName="bodyMaskPolicy" />
              <label class="form-check-label" for="bodyMaskPolicy0">Policy 0: {{'mask.none'|translate}}</label> -->
            </div>
            <div class="p-form-check mb-2">
              <p-radioButton formControlName="bodyMaskPolicy" value="1" inputId="bodyMaskPolicy1"></p-radioButton>
              <label for="bodyMaskPolicy1" class="ml-2 mb-0">Policy 1: {{
                'mask.body_before_after'|translate:{num:bodyMaskPolicyNum.value?bodyMaskPolicyNum.value:'1',
                mask:bodyMaskPolicySymbol.value?bodyMaskPolicySymbol.value:'*' } }}</label>
              <!-- <input type="radio" id="bodyMaskPolicy1" class="form-check-input" value="1"
                formControlName="bodyMaskPolicy" />
              <label class="form-check-label" for="bodyMaskPolicy1">Policy 1: {{
                'mask.body_before_after'|translate:{num:bodyMaskPolicyNum.value?bodyMaskPolicyNum.value:'1',
                mask:bodyMaskPolicySymbol.value?bodyMaskPolicySymbol.value:'*' } }}</label> -->
            </div>
            <div class="p-form-check mb-2">
              <p-radioButton formControlName="bodyMaskPolicy" value="2" inputId="bodyMaskPolicy2"></p-radioButton>
              <label for="bodyMaskPolicy2" class="ml-2 mb-0">Policy 2: {{
                'mask.body_before'|translate:{num:bodyMaskPolicyNum.value?bodyMaskPolicyNum.value:'1',
                mask:bodyMaskPolicySymbol.value?bodyMaskPolicySymbol.value:'*' } }}</label>
              <!-- <input type="radio" id="bodyMaskPolicy2" class="form-check-input" value="2"
                formControlName="bodyMaskPolicy" />
              <label class="form-check-label" for="bodyMaskPolicy2">Policy 2: {{
                'mask.body_before'|translate:{num:bodyMaskPolicyNum.value?bodyMaskPolicyNum.value:'1',
                mask:bodyMaskPolicySymbol.value?bodyMaskPolicySymbol.value:'*' } }}</label> -->
            </div>
            <div class="p-form-check mb-2">
              <p-radioButton formControlName="bodyMaskPolicy" value="3" inputId="bodyMaskPolicy3"></p-radioButton>
              <label for="bodyMaskPolicy3" class="ml-2 mb-0">Policy 3: {{
                'mask.body_after'|translate:{num:bodyMaskPolicyNum.value?bodyMaskPolicyNum.value:'1',
                mask:bodyMaskPolicySymbol.value?bodyMaskPolicySymbol.value:'*' } }}</label>
              <!-- <input type="radio" id="bodyMaskPolicy3" class="form-check-input" value="3"
                formControlName="bodyMaskPolicy" />
              <label class="form-check-label" for="bodyMaskPolicy3">Policy 3: {{
                'mask.body_after'|translate:{num:bodyMaskPolicyNum.value?bodyMaskPolicyNum.value:'1',
                mask:bodyMaskPolicySymbol.value?bodyMaskPolicySymbol.value:'*' } }}</label> -->
            </div>
            <div class="p-form-check">
              <p-radioButton formControlName="bodyMaskPolicy" value="4" inputId="bodyMaskPolicy4"></p-radioButton>
              <label for="bodyMaskPolicy4" class="ml-2 mb-0">Policy 4: {{
                'mask.body_after_regex'|translate:{num:bodyMaskPolicyNum.value?bodyMaskPolicyNum.value:'1',
                mask:bodyMaskPolicySymbol.value?bodyMaskPolicySymbol.value:'*' } }}</label>
              <!-- <input type="radio" id="bodyMaskPolicy4" class="form-check-input" value="4"
                formControlName="bodyMaskPolicy" />
              <label class="form-check-label" for="bodyMaskPolicy4">Policy 4: {{
                'mask.body_after_regex'|translate:{num:bodyMaskPolicyNum.value?bodyMaskPolicyNum.value:'1',
                mask:bodyMaskPolicySymbol.value?bodyMaskPolicySymbol.value:'*' } }}</label> -->
            </div>
            <div class="mt-1"
              *ngIf="bodyMaskPolicy.value=='1'||bodyMaskPolicy.value=='2'||bodyMaskPolicy.value=='3'||bodyMaskPolicy.value=='4'">
              <label class="control-label required mr-1" style="font-weight: 400;">{{'mask.word'|translate}}</label>
              <input type="number" [min]="1" [max]="9999" class="form-control mr-2" formControlName="bodyMaskPolicyNum"
                style="display: inline;width: 75px;" />
              <label class="control-label required mr-1">{{ 'mask.mask'|translate}}</label> <input type="text"
                class="form-control" formControlName="bodyMaskPolicySymbol" style="display: inline;width: 100px;"
                [minlength]="1" [maxlength]="10" (focusout)="checkbodyMaskPolicySymbol()" />
            </div>
          </div>
          <div class="col-12 pr-0"
            *ngIf="bodyMaskPolicy.value=='1'||bodyMaskPolicy.value=='2'||bodyMaskPolicy.value=='3'||bodyMaskPolicy.value=='4'">
            <div class="col-12 px-0 form-group" style="align-items: center;display: flex;">
              <label class="control-label required mr-1" style="white-space: nowrap;">{{ bodyMaskPolicy.value=='4'?
                'Regular expression':'keyword'|translate }}</label>
              <input type="text" class="form-control" formControlName="bodyMaskKeyword"
                [placeholder]="bodyMaskPolicy.value=='4'?'':('input_example.text' | translate)">
            </div>
            <div class="col-12 px-0">
              <label class="control-label">Example: {{ bodyMaskPolicy.value=='4'? ("mask.body_example_regex"|translate):
                ("mask.body_example"|translate) }}</label>
            </div>
          </div>
        </div>

      </div>

      <div class="form-group row" *ngIf="apiDetail.apiSrc.v =='R' && apiDetail?.type == '1'">
        <div class="col-12">
          <label class="control-label required">{{ 'fail_discovery_policy.label'| translate}}</label>
          <div class="col-12 form-group ">
            <div class="p-form-check mb-2">
              <p-radioButton formControlName="failDiscoveryPolicy" value="0"
                inputId="failDiscoveryPolicy"></p-radioButton>
              <label for="failDiscoveryPolicy" class="ml-2 mb-0">Policy 0:
                {{'fail_discovery_policy.policy_0'|translate}}</label>
              <!-- <input type="radio" class="form-check-input" value="0" formControlName="failDiscoveryPolicy"/>
              <label class="form-check-label">Policy 0: {{'fail_discovery_policy.policy_0'|translate}}</label> -->
            </div>
          </div>
        </div>
      </div>
      <div class="form-group row" *ngIf="apiDetail.apiSrc.v =='R' && apiDetail?.type == '1'">
        <div class="col-6">
          <label class="control-label required">{{ 'fail_handle_policy.label'| translate}}</label>
          <div class="col-12 form-group ">
            <div class="p-form-check mb-2">
              <p-radioButton formControlName="failHandlePolicy" value="0" inputId="failHandlePolicy0"></p-radioButton>
              <label for="failHandlePolicy0" class="ml-2 mb-0">Policy 0:
                {{'fail_handle_policy.policy_0'|translate}}</label>
              <!-- <input id="failHandlePolicy0" type="radio" class="form-check-input" value="0" formControlName="failHandlePolicy"/>
              <label for="failHandlePolicy0" class="form-check-label">Policy 0: {{'fail_handle_policy.policy_0'|translate}}</label> -->
            </div>
            <div class="p-form-check mb-2">
              <p-radioButton formControlName="failHandlePolicy" value="1" inputId="failHandlePolicy1"></p-radioButton>
              <label for="failHandlePolicy1" class="ml-2 mb-0">Policy 1:
                {{'fail_handle_policy.policy_1'|translate}}</label>
              <!-- <input id="failHandlePolicy1" type="radio" class="form-check-input" value="1" formControlName="failHandlePolicy"/>
              <label for="failHandlePolicy1" class="form-check-label">Policy 1: {{'fail_handle_policy.policy_1'|translate}}</label> -->
            </div>
          </div>
        </div>
      </div>

      <div class="form-group row">
        <div class="col-sm-12">
          <label id="apiDesc_label" class="control-label">{{"api_desc" | translate}}</label>
          <textarea class="form-control" rows="5" formControlName="apiDesc"></textarea>
        </div>
      </div>



      <div class="form-group row">
        <div class="col-12">
          <label id="mockStatusCode_label" class="control-label">{{
            "mockStatusCode" | translate
            }}</label>
          <input type="text" class="form-control" formControlName="mockStatusCode" id="mockStatusCode" />
          <div *ngIf="u_mockStatusCode.invalid && (u_mockStatusCode.dirty || u_mockStatusCode.touched)"
            class="text-danger">
            <small class="form-text">{{ u_mockStatusCode.errors.maxlength | translate}}</small>
            <small class="form-text">{{ u_mockStatusCode.errors.pattern }}</small>
          </div>
        </div>
      </div>

      <div class="form-group row col-12">
        <app-mock-headers-input formControlName="mockHeaders"></app-mock-headers-input>
      </div>

      <div class="form-group row">
        <div class="col-12">
          <label id="mockBody_label" class="control-label">{{
            "mockBody" | translate
            }}</label>
          <textarea rows="5" class="form-control" formControlName="mockBody" id="mockBody"></textarea>
          <div *ngIf="u_mockBody.invalid && (u_mockBody.dirty || u_mockBody.touched)" class="text-danger">
            <small class="form-text">{{ u_mockBody.errors.maxlength | translate}}</small>
            <small class="form-text">{{ u_mockBody.errors.pattern }}</small>
          </div>
        </div>
      </div>

      <div class="form-group row">
        <div class="col-12">
          <label class="control-label">{{ "label_tag" | translate }}</label>
          <div>
            <p-chips id="labelList" formControlName="labelList" [max]="5" [allowDuplicate]="false"
              (onAdd)="checkChips($event)" [placeholder]="'label_tag_max'|translate:{value:5}"></p-chips>
            <div *ngIf="showLabelList_tip" class="text-danger">
              <small class="form-text">{{ 'validation.maxlength'| translate:{value:20} }}</small>
            </div>
          </div>
        </div>
      </div>


      <div class="form-group row ">
        <div class="col-12">
          <button type="button" class="btn tpi-btn tpi-primary mr-3" (click)="updateApi()"
            [disabled]="updateForm.invalid">
            {{ "button.update" | translate }}
          </button>
          <button *ngIf="apiDetail.apiSrc.v == 'C'" type="button" class="btn tpi-btn tpi-primary mr-3"
            (click)="openComposer()">
            {{ "open_editor" | translate }}
          </button>
          <button type="button" class="btn tpi-btn tpi-primary" (click)="changePage('query')">
            {{ "button.return_to_list" | translate }}
          </button>
        </div>
      </div>
    </form>
  </div>
  <div *ngIf="pageNum == 4">
    <app-api-test [data]="initData"></app-api-test>
    <div class="form-group row mt-2">
      <div class="col-12">
        <button type="button" class="btn tpi-btn tpi-primary float-left" (click)="changePage('query')">
          {{ "button.return_to_list" | translate }}
        </button>
      </div>
    </div>
  </div>
  <!-- 匯入註冊/組合api檔案 (原ac0318) -->
  <div *ngIf="pageNum == 5">
    <form [formGroup]="form">
      <div class="form-group row">
        <div class="col-6">
          <div class="ui-inputgroup">
            <input type="file" id="file" accept=".json" (change)="changeFile($event)" formControlName="file"
              style="display: none;">
            <input type="text" class="form-control" formControlName="fileName"
              placeholder="{{'chs_json_file' | translate}}">
            <button pButton type="button" icon="pi pi-file" class="ml-1 tpi-primary"
              (click)="openFileBrowser();"></button>
          </div>
        </div>
        <div class="col-6">
          <button type="button" class="btn tpi-btn tpi-primary float-left" (click)="uploadFile()"
            [disabled]="!file.value">
            {{'button.upload'|translate}}
          </button>
        </div>
      </div>
      <div *ngIf="file.value" class="form-group row">
        <div class="col-3" style="display:table-cell">
          <label class="control-label">{{fileName.value}}</label>
        </div>
        <div class="col-3" style="display:table-cell">
          <label class="control-label">{{fileSize.value}}KB</label>
        </div>
      </div>
    </form>
    <p-table *ngIf="import_cols" [columns]="import_cols" [value]="import_apiList" [(selection)]="import_selected"
      styleClass="p-datatable-striped" [style]="{'word-break':'break-word'}" responsiveLayout="scroll">
      <ng-template pTemplate="caption">
        <div class="ui-helper-clearfix">
          <button [disabled]="!import_apiList || import_selected.length == 0" type="button"
            class="btn tpi-btn tpi-primary float-left mr-1" (click)="import()">
            {{ 'button.import' | translate }}
          </button>

        </div>
      </ng-template>
      <ng-template pTemplate="colgroup" let-columns>
      </ng-template>
      <ng-template pTemplate="header" let-columns selectionMode="multiple">
        <tr style="text-align: center">
          <th rowspan="2" style="width: 2.25em" scope="col">
            <p-tableHeaderCheckbox (click)="selectAll($event)"></p-tableHeaderCheckbox>
          </th>
          <th rowspan="1" (click)="changeSort('apiKey');" scope="col">
            {{'api_key'|translate}}
            <p-sortIcon [field]="apiKey"></p-sortIcon>
          </th>
          <th rowspan="2" (click)="changeSort('apiName');" scope="col">
            {{'tar_url'|translate}}
            <p-sortIcon [field]="srcURL"></p-sortIcon>
          </th>
          <th rowspan="2" (click)="changeSort('apiSrc');" scope="col">
            {{'api_src'|translate}}
            <p-sortIcon [field]="apiSrc"></p-sortIcon>
          </th>
          <th rowspan="2" (click)="changeSort('endpoint');" scope="col">
            {{'end_point'|translate}}
            <p-sortIcon [field]="endpoint"></p-sortIcon>
          </th>
          <th rowspan="1" scope="col">{{'check_action'|translate}}</th>
          <th rowspan="1" scope="col">{{'import_result'|translate}}</th>
        </tr>
        <tr style="text-align: center">
          <th rowspan="1" colspan="1" scope="col">{{'api_name'|translate}}</th>
          <th rowspan="1" colspan="2" scope="col">{{'desc'|translate}}</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowData let-columns="columns">
        <tr style="text-align: center">
          <td rowspan="2" style="width: 2.25em">
            <p-tableCheckbox [value]="rowData" [disabled]="rowData.checkAct.v === 'N'">
            </p-tableCheckbox>
          </td>
          <td rowspan="1" style="width: auto;">
            {{originStringTable(rowData.apiKey)}}
            <label class="moreless" *ngIf="rowData.apiKey.ori" (click)="switchOri(rowData.apiKey)">
              {{rowData.apiKey.t ? ("show_more" | translate) :'' }}
              <i class="fas"
                [ngClass]="[rowData.apiKey.t ?  'fa-angle-double-right mt-1' : 'fa-angle-double-left  mt-1 mr-1']"></i>
              {{rowData.apiKey.t ? '' : ("show_less" | translate) }}
            </label>

          </td>
          <td rowspan="2" style="width: auto;">
            <span [innerHTML]="decodeSrcUrl( rowData.srcURL)"></span>
            <div *ngFor="let srcUrlItem of rowData?.srcURLByIpRedirectMap">
              <div>
                <span *ngIf="srcUrlItem.ip!=''">[{{srcUrlItem.ip}}]</span>
              </div>
              <span [innerHTML]="decodeSrcUrl( srcUrlItem.srcURL)"></span>
            </div>
          </td>
          <td rowspan="2" style="width: auto;">
            {{ rowData.apiSrc.n }}
          </td>
          <td rowspan="2" style="width: auto;">
            {{ rowData.endpoint }}
          </td>
          <td rowspan="1" style="width: auto;">
            {{ rowData.checkAct.n }}
          </td>
          <td rowspan="1"
            [ngStyle]="{'width': 'auto', 'background-color': (rowData.result &&rowData.result.v === 'F') ? '#FAEBD7' : ''}">
            <span *ngIf="rowData.result">
              {{ rowData.result.n }}
            </span>
          </td>
        </tr>
        <tr style="text-align: center">
          <td rowspan="1" colspan="1">
            {{originStringTable(rowData.apiName)}}
            <label class="moreless" *ngIf="rowData.apiName.ori" (click)="switchOri(rowData.apiName)">
              {{rowData.apiName.t ? ("show_more" | translate) :'' }}
              <i class="fas"
                [ngClass]="[rowData.apiName.t ?  'fa-angle-double-right mt-1' : 'fa-angle-double-left  mt-1 mr-1']"></i>
              {{rowData.apiName.t ? '' : ("show_less" | translate) }}
            </label>
          </td>
          <td rowspan="1" colspan="2"
            [ngStyle]="{'width': 'auto', 'background-color': (rowData.result &&rowData.result.v === 'F') ? '#FAEBD7' : ''}">
            {{originStringTable(rowData.memo)}}
            <label class="moreless" *ngIf="rowData.memo.ori" (click)="switchOri(rowData.memo)">
              {{rowData.memo.t ? ("show_more" | translate) :'' }}
              <i class="fas"
                [ngClass]="[rowData.memo.t ?  'fa-angle-double-right mt-1' : 'fa-angle-double-left  mt-1 mr-1']"></i>
              {{rowData.memo.t ? '' : ("show_less" | translate) }}
            </label>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="footer" let-columns>
        <tr *ngIf="import_apiList.length>0" style="color: #b7b7b7;">
          <td [attr.colspan]="columns.length+1">{{'row_count' | translate}}: {{import_apiList.length}}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage" let-columns>
        <tr>
          <td [attr.colspan]="columns.length+1">
            {{'no_rec' | translate}}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</app-container>
<!-- <app-dialog [title]="dialogTitle" #dialog></app-dialog> -->
<p-dialog [title]="dialogTitle" #dialog></p-dialog>
<p-toast [style]="{ marginTop: '60px' }" position="top-left"></p-toast>
<!-- <p-toast position="center" key="confirm" (onClose)="onReject()" [baseZIndex]="5000">
    <ng-template let-message pTemplate="message">
        <div style="text-align: center">
            <em class="fas fa-exclamation-triangle fa-3x"></em>
            <h4>{{message.summary}}</h4>
            <p>{{message.detail}}</p>
        </div>
        <div class="ui-g ui-fluid">
            <div class="ui-g-6">
                <button type="button" pButton (click)="active()" label="{{'button.confirm'|translate}}"
                    class="ui-button-success"></button>
            </div>
            <div class="ui-g-6">
                <button type="button" pButton (click)="onReject()" label="{{'button.cancel'|translate}}"
                    class="ui-button-secondary"></button>
            </div>
        </div>
    </ng-template>
</p-toast> -->
<!-- <p-toast position="center" key="delete" (onClose)="onReject()" [baseZIndex]="5000" >
    <ng-template let-message pTemplate="message">
        <div style="text-align: center">
            <em class="fas fa-exclamation-triangle fa-3x"></em>
            <h4>{{message.summary}}</h4>
        </div>
        <div class="grid p-fluid">
            <div class="ui-g-6">
                <button type="button" pButton (click)="defineDelete();" label="{{'button.confirm'|translate}}"
                    class="ui-button-success"></button>
            </div>
            <div class="ui-g-6">
                <button type="button" pButton (click)="onReject()" label="{{'button.cancel'|translate}}"
                    class="ui-button-secondary"></button>
            </div>
        </div>
    </ng-template>
</p-toast>

<p-toast position="center" key="confirm" (onClose)="onReject()" [baseZIndex]="5000" closable="true">
  <ng-template let-message pTemplate="message">
      <div class="flex flex-column" style="flex: 1">
          <div class="text-center">
              <i class="pi pi-exclamation-triangle" style="font-size: 3rem"></i>
              <h4>{{message.summary}}***</h4>
              <p>{{message.detail}}</p>
          </div>
          <div class="flex-row col-12 text-center">


                  <button type="button" pButton (click)="active()" label="{{'button.confirm'|translate}}" class="p-button-success mr-3"></button>

                  <button type="button" pButton (click)="onReject()" label="{{'button.cancel'|translate}}" class="p-button-secondary"></button>

          </div>
      </div>
  </ng-template>
</p-toast> -->

<p-confirmDialog key="cd" #cd [style]="{ width: '50vw' }" icon="pi pi-exclamation-triangle"
  styleClass="cHeader cContent cIcon">
  <ng-template pTemplate="footer">
    <div class="row" style="justify-content: center">
      <button type="button" pButton icon="pi pi-check" [ngStyle]="{
          backgroundColor: 'var(--red-300)',
          'border-color': 'var(--red-300)'
        }" label="{{ 'button.confirm' | translate }}" (click)="cd.accept()"></button>
      <button type="button" pButton icon="pi pi-times" class="p-button-secondary"
        label="{{ 'button.cancel' | translate }}" (click)="cd.reject()"></button>
    </div>
  </ng-template>
</p-confirmDialog>

<p-confirmDialog key="del" #del [style]="{ width: '50vw' }" icon="pi pi-exclamation-triangle"
  styleClass="cHeader cContent cIcon">
  <ng-template pTemplate="footer">
    <div class="row" style="justify-content: center">
      <button type="button" pButton icon="pi pi-check" [ngStyle]="{
          backgroundColor: 'var(--red-300)',
          'border-color': 'var(--red-300)'
        }" label="{{ 'button.confirm' | translate }}" (click)="del.accept()"></button>
      <button type="button" pButton icon="pi pi-times" class="p-button-secondary"
        label="{{ 'button.cancel' | translate }}" (click)="del.reject()"></button>
    </div>
  </ng-template>
</p-confirmDialog>
