"use strict";(self.webpackChunksrcAngular=self.webpackChunksrcAngular||[]).push([[3076],{13076:(D,f,i)=>{i.r(f),i.d(f,{LoginModule:()=>Y});var T=i(24783),m=i(69808),d=i(99291),U=i(96614),v=i(55679),A=i(24300),L=i(27896),C=i(4924),Z=i(40704),b=i(45682),S=i(89709),l=i(93075),k=i(18505),y=i(68306),x=i(92340),e=i(87587),B=i(3937),I=i(40520),_=i(51062);const J=["username"];function R(n,u){if(1&n){const t=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){e.CHM(t);const s=e.oxw().$implicit;return e.oxw().goCusPage(s.cusLoginUrl)}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.acIdpInfoCusName," ")}}function P(n,u){if(1&n&&(e.ynx(0),e.YNc(1,R,2,1,"button",29),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.cusIdpLoginList.length>0)}}function N(n,u){if(1&n){const t=e.EpF();e.ynx(0,30),e.TgZ(1,"button",23),e.NdJ("click",function(){return e.CHM(t),e.oxw().goCusPage()}),e._uU(2," CUS "),e.qZA(),e.BQk()}}const F=[{path:"",component:(()=>{class n{constructor(t,o,s,r,a,g,p,c,h,M,O,q,Q){this.fb=t,this.router=o,this.ngxService=s,this.tokenService=r,this.toolService=a,this.alertService=g,this.signBlockService=p,this.util=c,this.userService=h,this.funcService=M,this.route=O,this.httpClient=q,this.translate=Q,this.isReady=!1,this.relogin=!1,this.cusIdpLoginList=[],this.form=this.fb.group({uname:new l.NI(""),pwd:new l.NI("")})}ngOnInit(){this.route.queryParams.subscribe(t=>{this.relogin=null==t.re}),setTimeout(()=>{this.isReady=!0,setTimeout(()=>{this.username.nativeElement.focus()},0)},1e3),this.getCusLoginUrl()}ngAfterViewInit(){this.username.nativeElement.focus()}getCusLoginUrl(){let t="";t="localhost"==location.hostname||"127.0.0.1"==location.hostname?x.N.apiUrl:`${location.protocol}//${location.hostname}:${location.port}`,t+="/dgrv4/ssotoken/acCusIdp/login/getCusLoginUrl",this.httpClient.get(t,{responseType:"text"}).subscribe(o=>{o&&(this.cusIdpLoginList=JSON.parse(o).map(s=>s))})}goCusPage(t){t?window.location.href=t:this.translate.get("noCusInfo").subscribe(o=>{this.alertService.ok(o,"")})}submitForm(){var t,o,s;""!=(null===(t=this.form.get("uname"))||void 0===t?void 0:t.value)?(this.ngxService.start(),this.tokenService.auth(null===(o=this.form.get("uname"))||void 0===o?void 0:o.value,this.toolService.Base64Encoder(null===(s=this.form.get("pwd"))||void 0===s?void 0:s.value)).subscribe(r=>{if(r&&r.access_token)this.toolService.setTokenInfo(r),this.toolService.writeToken(r.access_token),this.toolService.writeToken(JSON.stringify(this.toolService.decodeToken()),"decode_token"),this.signBlockService.getSignBlock().subscribe(a=>{this.toolService.checkSuccess(a.ResHeader)&&(this.toolService.writeSignBlock(a.Res_getSignBlock.signBlock),this.util.getAcConf().subscribe(g=>{this.toolService.checkDpSuccess(g.ResHeader)&&(this.toolService.writeAcConf(JSON.stringify(g.RespBody)),this.auth(["AC0004","AC0005","AC0102","AC0203","AC0204","AC0205","AC0221","AC0223","AC0224","AC0225","AC0226","AC0302","AC0304","AC0305","AC0318","AC0505"]).subscribe(c=>{this.toolService.setHyperLinkAuth(c)}),this.userService.queryUserDataByLoginUser().subscribe(c=>{this.toolService.checkDpSuccess(c.ResHeader)&&(this.toolService.setUserID(c.RespBody.userID),this.toolService.setUserAlias(c.RespBody.userAlias?c.RespBody.userAlias:""),this.setFuncList().pipe((0,k.b)(h=>{h&&this.router.navigateByUrl("/dashboard")})).subscribe())}))}))});else{let a=r.ResHeader;this.alertService.ok(a.rtnCode,a.rtnMsg)}this.ngxService.stopAll()})):this.translate.get("user_name_required").subscribe(r=>{this.alertService.ok(r,"")})}setFuncList(){return new y.y(t=>{this.funcService.queryAllFunc().subscribe(o=>{this.toolService.checkDpSuccess(o.ResHeader)&&(this.toolService.setFuncList(o.RespBody.funcList),t.next(!0))})})}auth(t){let o=[];return new y.y(s=>{this.userService.queryFuncByLoginUser().subscribe(r=>{if(this.toolService.checkDpSuccess(r.ResHeader)){this.toolService.writeRoleFuncCodeList(r.RespBody.funcCodeList);for(let a=0;a<t.length;a++){const g=t[a];let p=r.RespBody.funcCodeList.findIndex(c=>c===g);o.findIndex(c=>c.funCode==g)<0?o.push({funCode:g,canExecute:p>=0}):p>=0&&(o[o.findIndex(c=>c.funCode==g)].canExecute=!0)}s.next(o)}})})}ssologin(t){window.location.href=`${location.protocol}//${location.host}/dgrv4/ssotoken/acidp/${t}/acIdPAuth`}goLdapPage(){this.router.navigate(["/ldap"],{queryParams:{type:"LDAP"}})}goMLdapPage(){this.router.navigate(["/ldap"],{queryParams:{type:"MLDAP"}})}goAPIPage(){this.router.navigate(["/ldap"],{queryParams:{type:"API"}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(l.qu),e.Y36(d.F0),e.Y36(B.LA),e.Y36(S.B),e.Y36(b.g),e.Y36(Z.c),e.Y36(C.T),e.Y36(L.f),e.Y36(A.K),e.Y36(v.B),e.Y36(d.gz),e.Y36(I.eN),e.Y36(_.sK))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-login"]],viewQuery:function(t,o){if(1&t&&e.Gf(J,7),2&t){let s;e.iGM(s=e.CRH())&&(o.username=s.first)}},features:[e._Bn([S.B,Z.c,b.g,C.T,L.f,A.K,v.B,U.K])],decls:59,vars:27,consts:[[1,"login-page",3,"hidden"],[1,"image-panel"],["src","assets/images/img_login_visual.png",1,"img-building"],[1,"form-panel"],[3,"formGroup","ngSubmit"],[1,"login_section"],["src","assets/images/DigiFusion_digiRunner_logo_horizontal.png","alt","","title","v202102251030-v3",1,"img-logo"],[1,"line"],[3,"hidden"],[1,"form-wrapper"],[1,"form-area"],[1,"input-line"],["for","uname"],[1,"input-sign-wrapper"],[1,"sign"],["src","assets/images/login/i_user.png","alt","number"],["type","text","formControlName","uname",1,"form-control",3,"placeholder"],["username",""],["src","assets/images/login/i_pwd.png","alt","pass"],["type","password","formControlName","pwd",1,"form-control",3,"placeholder"],[1,"sign-btn-grid"],["type","submit",1,"btn","btn-login"],[1,"sign-btn-grid",2,"--grid-columns","1fr 1fr"],["type","button",1,"btn","btn-login",3,"click"],[1,"pi","pi-google"],[1,"pi","pi-microsoft"],[4,"ngFor","ngForOf"],["class","sign_row",4,"ngIf"],[1,"login-footer"],["type","button","class","btn btn-login",3,"click",4,"ngIf"],[1,"sign_row"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"img",2),e.qZA(),e.TgZ(3,"div",3)(4,"form",4),e.NdJ("ngSubmit",function(){return o.submitForm()}),e.TgZ(5,"section",5),e._UZ(6,"img",6),e.TgZ(7,"div",7)(8,"p",8),e._uU(9,"Welcome Back!"),e.qZA(),e.TgZ(10,"div",8)(11,"span"),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"span"),e._uU(15),e.ALo(16,"translate"),e.qZA()()(),e.TgZ(17,"div",9)(18,"div",10)(19,"div",11)(20,"label",12),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"div",13)(24,"span",14),e._UZ(25,"img",15),e.qZA(),e._UZ(26,"input",16,17),e.ALo(28,"translate"),e.qZA()(),e.TgZ(29,"div",11)(30,"label",12),e._uU(31),e.ALo(32,"translate"),e.qZA(),e.TgZ(33,"div",13)(34,"span",14),e._UZ(35,"img",18),e.qZA(),e._UZ(36,"input",19),e.ALo(37,"translate"),e.qZA()()(),e.TgZ(38,"div",20)(39,"button",21),e._uU(40),e.ALo(41,"translate"),e.qZA()(),e.TgZ(42,"div",22)(43,"button",23),e.NdJ("click",function(){return o.ssologin("GOOGLE")}),e._UZ(44,"i",24),e.qZA(),e.TgZ(45,"button",23),e.NdJ("click",function(){return o.ssologin("MS")}),e._UZ(46,"i",25),e.qZA(),e.TgZ(47,"button",23),e.NdJ("click",function(){return o.goLdapPage()}),e._uU(48," LDAP "),e.qZA(),e.TgZ(49,"button",23),e.NdJ("click",function(){return o.goMLdapPage()}),e._uU(50," MLDAP "),e.qZA()(),e.TgZ(51,"div",20)(52,"button",23),e.NdJ("click",function(){return o.goAPIPage()}),e._uU(53," API "),e.qZA(),e.YNc(54,P,2,1,"ng-container",26),e.YNc(55,N,3,0,"ng-container",27),e.qZA()()()()(),e.TgZ(56,"footer",28)(57,"span"),e._uU(58,"Copyright\xa9 TPIsoftware. All Rights Reserved."),e.qZA()()()),2&t&&(e.Q6J("hidden",!o.isReady),e.xp6(4),e.Q6J("formGroup",o.form),e.xp6(4),e.Q6J("hidden",!o.relogin),e.xp6(2),e.Q6J("hidden",o.relogin),e.xp6(2),e.Oqu(e.lcZ(13,13,"logoutBySystem")),e.xp6(3),e.Oqu(e.lcZ(16,15,"plz_login_again")),e.xp6(6),e.Oqu(e.lcZ(22,17,"user_name")),e.xp6(5),e.Q6J("placeholder",e.lcZ(28,19,"user_name")),e.xp6(5),e.Oqu(e.lcZ(32,21,"user_password")),e.xp6(5),e.Q6J("placeholder",e.lcZ(37,23,"user_password")),e.xp6(4),e.hij(" ",e.lcZ(41,25,"login")," "),e.xp6(14),e.Q6J("ngForOf",o.cusIdpLoginList),e.xp6(1),e.Q6J("ngIf",0==o.cusIdpLoginList.length))},directives:[l._Y,l.JL,l.sg,l.Fj,l.JJ,l.u,m.sg,m.O5],pipes:[_.X$],styles:[""]}),n})()}];let w=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[d.Bz.forChild(F)],d.Bz]}),n})(),Y=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[m.ez,w,l.u5,l.UX,T.m]]}),n})()}}]);