"use strict";(self.webpackChunksrcAngular=self.webpackChunksrcAngular||[]).push([[8194],{81027:(F,E,a)=>{a.r(E),a.d(E,{Ac0316Module:()=>_});var x=a(45330),I=a(69808),A=a(99291),b=a(15861),O=a(14525),i=a(93075),L=a(10784),D=a(95244),S=a(40520),B=a(57553),C=a(58348),w=a(81073),p=a(51033),o=a(87587),M=a(56435),U=a(89709),k=a(45682),J=a(3937),G=a(4924),Y=a(40704),W=a(63710),$=a(56237);const j=["keyValueForm"],z=["keyValueRequest"];let K=(()=>{class n extends O.H{constructor(e,t,s,r,l,g,d,u,h,T,N,f,c){super(e,t),this.fb=s,this.tokenService=r,this.toolService=l,this.api=g,this.httpClient=d,this.ngxService=u,this.signBlockService=h,this.moduleService=T,this.alert=N,this.tool=f,this.dc=c,this.apiKey="",this.moduleName="",this.apiSrc="",this.methods=[],this.dcs=[],this.sites=[],this.resTime="",this.funCode="",this.protocol="",this.initData={},this.acConf=this.tool.getAcConf(),this.form=this.fb.group({enableClientAuth:new i.NI(!0),enableUserAuth:new i.NI(!1),userName:new i.NI({value:"",disabled:!0}),passwd:new i.NI({value:"",disabled:!0}),clientId:new i.NI(""),clientPasswd:new i.NI(""),tsmpUrl:new i.NI(""),method:new i.NI("POST"),requestHeader:new i.NI,ContentType:new i.NI("application/json"),requestBody:new i.NI("none"),keyValueRequest:new i.NI(""),keyValueForm:new i.NI(""),bodyText:new i.NI(""),resBody:new i.NI({value:"",disabled:!1}),resStatus:new i.NI({value:"",disabled:!1}),headerList:new i.NI({value:"",disabled:!1}),dc:new i.NI(""),siteCode:new i.NI(""),baseUrl:new i.NI(location.hostname+(location.port?":"+location.port:""))})}ngOnInit(){this.route.params.subscribe(e=>{this.apiKey=null==e.apiKey?"":e.apiKey,this.moduleName=null==e.moduleName?"":e.moduleName,this.apiSrc=null==e.apiSrc?"":e.apiSrc,this.initData={apiKey:this.apiKey,moduleName:this.moduleName,apiSrc:this.apiSrc}})}init(){this.methods=L.K.methods}loadData(){""!=this.apiKey&&""!=this.moduleName&&this.api.queryAPIDetail_v3({moduleName:this.moduleName,apiKey:this.apiKey}).subscribe(t=>{if(this.tool.checkDpSuccess(t.ResHeader)){var s="";let r=t.RespBody.moduleName.t?t.RespBody.moduleName.o:t.RespBody.moduleName.v,l=t.RespBody.apiKey.t?t.RespBody.apiKey.o:t.RespBody.apiKey.v;switch(this.apiSrc){case"M":default:this.dc.queryDCList_2({moduleName:r}).subscribe(d=>{var u,h,T;if(this.tool.checkDpSuccess(d.ResHeader)){let N=new RegExp('[\\[\\]"]'),f="",c=(null===(h=null===(u=t.RespBody)||void 0===u?void 0:u.pathOfJson)||void 0===h?void 0:h.t)?t.RespBody.pathOfJson.o:null===(T=t.RespBody.pathOfJson)||void 0===T?void 0:T.v;if(c)for(let m=0;m<c.length;m++)f+=c.substr(m,1).replace(N,"");if(!d.RespBody.dcList||(null==r?void 0:r.includes("tsmpaa")))s=r+f;else{let m=[],y=d.RespBody.dcList.filter(v=>1==v.active);if(0!=y.length)for(let v of y)m.push({label:this.acConf.dcPrefix+v.dcCode,value:v.dcCode});else d.RespBody.dcList.map(v=>{m.push({label:this.acConf.dcPrefix+v.dcCode,value:v.dcCode})});this.dcs=m,this.form.get("dc").setValue(this.dcs[0].value);let P=this.acConf.dcPrefix.substring(1,this.acConf.dcPrefix.length);s=P+this.form.get("dc").value+"/"+r+f,this.form.get("dc").valueChanges.subscribe(v=>{let H=P+v+"/"+this.moduleName+f;""==v&&(H=this.moduleName+f),this.form.get("tsmpUrl").setValue(H)})}this.form.get("tsmpUrl").setValue(s)}});break;case"C":case"R":s="tsmpc/"+r+"/"+l,this.form.get("tsmpUrl").setValue(s)}if(t.RespBody.methodOfJson){let g=t.RespBody.methodOfJson.split(",");this.form.get("method").setValue(g.length>0?g[0]:"POST")}}})}add(e){"request"===e?this.kv_request.add():this.kv_form.add()}send(){var e=this;return(0,b.Z)(function*(){const s=yield e.toolService.getDict(["dialog.warn","client_id_required","client_pwd_required","user_name_required","password_required","digirunner_required","header_key_required"]);e.form.get("resBody").setValue(""),e.form.get("resStatus").setValue(""),e.form.get("headerList").setValue(""),e.resTime="";var r=e.form.get("clientId").value,l=e.form.get("clientPasswd").value,g=e.form.get("userName").value,d=e.form.get("passwd").value;let u=B.qJ.password;if(e.form.get("enableClientAuth").value){if(u=B.qJ.client_credentials,""==r)return void e.alert.ok(s["dialog.warn"],s.client_id_required);if(""==l)return void e.alert.ok(s["dialog.warn"],s.client_pwd_required);l=e.toolService.Base64Encoder(l)}if(e.form.get("enableUserAuth").value){if(u=B.qJ.password,""==g)return void e.alert.ok(s["dialog.warn"],s.user_name_required);if(""==d)return void e.alert.ok(s["dialog.warn"],s.password_required);d=e.toolService.Base64Encoder(d)}if(""==e.form.get("tsmpUrl").value.trim())return void e.alert.ok(s["dialog.warn"],s.digirunner_required);let h=new Array;h=h.concat(e.keyvalueConvetToList(e.form.get("keyValueRequest").value));var T=!0;if(h.forEach(function(c){null!=c&&""==c.name.trim()&&""!=c.value.trim()&&(T=!1)}),1!=T)return void e.alert.ok(s["dialog.warn"],s.header_key_required);e.ngxService.start();let N=e.protocol+"//"+e.form.get("baseUrl").value+"/"+e.form.get("tsmpUrl").value;h=new Array,h=h.concat(e.keyvalueConvetToList(e.form.get("keyValueRequest").value));let f=e.reqBodyHandler();if(e.form.get("enableClientAuth").value||e.form.get("enableUserAuth").value){if(""==r)return e.alert.ok(s["dialog.warn"],s.client_id_required),void e.ngxService.stop();if(""==l)return e.alert.ok(s["dialog.warn"],s.client_pwd_required),void e.ngxService.stop();e.tokenService.authBytestApi(r,l,g,d,u).subscribe(c=>{e.signBlockService.getTestSignBlock(c.access_token).subscribe(m=>{let v=e.createHeader(c.access_token,m.Res_getSignBlock.signBlock,h,f);e.startTimestamp=(new Date).getTime(),e.httpClientHandle(N,v,f)})})}else{let c=e.form.get("ContentType").value,m=new S.WM;""!=c&&c.toLowerCase()!="multipart/form-data".toLowerCase()&&(m=m.append("Content-Type",c)),h.forEach(function(y){null!=y&&""!=y.name&&""!=y.value&&(m=m.append(y.name,y.value))}),e.startTimestamp=(new Date).getTime(),e.httpClientHandle(N,m,f)}})()}reqBodyHandler(){let e;switch(this.form.get("requestBody").value){case"body":case"xml":e=this.form.get("bodyText").value;break;case"form":let r=new Array;r=r.concat(this.keyvalueConvetToList(this.form.get("keyValueForm").value)),e=new FormData;for(var t=0;t<r.length;t++)e.append((s=r[t]).name,s.value);break;case"formurl":for(r=new Array,r=r.concat(this.keyvalueConvetToList(this.form.get("keyValueForm").value)),e=new URLSearchParams,t=0;t<r.length;t++){var s;e.set((s=r[t]).name,s.value)}e=e.toString();break;case"none":e=null}return e}httpClientHandle(e,t,s){switch(this.form.get("method").value.toUpperCase()){case"GET":this.httpClient.get(`${e}`,{headers:t,observe:"response",responseType:"text"}).subscribe(r=>{this.bindResResult(r)});break;case"HEAD":this.httpClient.head(`${e}`,{headers:t,observe:"response",responseType:"text"}).subscribe(r=>{this.bindResResult(r)});break;case"POST":this.httpClient.post(`${e}`,s,{headers:t,observe:"response",responseType:"text"}).subscribe(r=>{this.bindResResult(r)});break;case"PUT":this.httpClient.put(`${e}`,s,{headers:t,observe:"response",responseType:"text"}).subscribe(r=>{this.bindResResult(r)});break;case"DELETE":this.httpClient.delete(`${e}`,{headers:t,observe:"response",responseType:"text"}).subscribe(r=>{this.bindResResult(r)});break;case"CONNECT":case"TRACE":break;case"OPTIONS":this.httpClient.options(`${e}`,{headers:t,observe:"response",responseType:"text"}).subscribe(r=>{this.bindResResult(r)});break;case"PATCH":this.httpClient.patch(`${e}`,s,{headers:t,observe:"response",responseType:"text"}).subscribe(r=>{this.bindResResult(r)})}}bindResResult(e){this.calResponseTime();let t={};e.headers.keys().map(l=>{e.headers.get(l),t[l]=e.headers.get(l)}),this.form.get("resBody").setValue(e.body),this.form.get("resStatus").setValue(e.status),this.form.get("headerList").setValue(JSON.stringify(t)),this.ngxService.stop()}enableClientAuthHandler(){1==this.form.get("enableClientAuth").value?(this.form.get("clientId").enable(),this.form.get("clientPasswd").enable()):(this.form.get("clientId").setValue(""),this.form.get("clientId").disable(),this.form.get("clientPasswd").setValue(""),this.form.get("clientPasswd").disable())}enableUserAuthHandler(){1==this.form.get("enableUserAuth").value?(this.form.get("userName").enable(),this.form.get("passwd").enable()):(this.form.get("userName").setValue(""),this.form.get("userName").disable(),this.form.get("passwd").setValue(""),this.form.get("passwd").disable())}handleChange(){switch(this.form.get("requestBody").value){case"body":case"none":this.form.get("ContentType").setValue("application/json");break;case"form":this.form.get("ContentType").setValue("multipart/form-data");break;case"formurl":this.form.get("ContentType").setValue("application/x-www-form-urlencoded");break;case"xml":this.form.get("ContentType").setValue("application/xml")}}keyvalueConvetToList(e){let t=[];return e&&e.length&&(t=e.map(s=>({name:s.key,value:s.value}))),t}createHeader(e,t,s,r){var l=this.form.get("ContentType").value;let g=this.cryptSignCode(r,t),d=new S.WM({SignCode:g,Authorization:`Bearer ${e}`});return""!=l&&l.toLowerCase()!="multipart/form-data".toLowerCase()&&(d=d.append("Content-Type",l)),s.forEach(function(u){null!=u&&""!=u.name&&""!=u.value&&(d=d.append(u.name,u.value))}),d}cryptSignCode(e,t){const s=t,r=e;return D("sha256").update(s+r).digest("hex")}calResponseTime(){const t=(new Date).getTime()-this.startTimestamp;this.resTime=t+"ms"}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(A.gz),o.Y36(M.W),o.Y36(i.qu),o.Y36(U.B),o.Y36(k.g),o.Y36(C.s),o.Y36(S.eN),o.Y36(J.LA),o.Y36(G.T),o.Y36(w.C),o.Y36(Y.c),o.Y36(k.g),o.Y36(p.N))},n.\u0275cmp=o.Xpm({type:n,selectors:[["app-ac0316"]],viewQuery:function(e,t){if(1&e&&(o.Gf(j,5),o.Gf(z,5)),2&e){let s;o.iGM(s=o.CRH())&&(t.kv_form=s.first),o.iGM(s=o.CRH())&&(t.kv_request=s.first)}},features:[o._Bn([C.s,w.C,p.N]),o.qOj],decls:2,vars:2,consts:[[3,"title"],[3,"data"]],template:function(e,t){1&e&&(o.TgZ(0,"app-container",0),o._UZ(1,"app-api-test",1),o.qZA()),2&e&&(o.Q6J("title",t.title),o.xp6(1),o.Q6J("data",t.initData))},directives:[W.e,$.N],styles:['.card-radius[_ngcontent-%COMP%]{border-radius:1em;border:3px solid #d1d1d1}.card[_ngcontent-%COMP%]{display:block}.required[_ngcontent-%COMP%]:after{content:"*";color:red}']}),n})();var V=a(86347);const Q=[{path:"",component:K,canActivate:[V.u6]},{path:":apiKey/:moduleName/:apiSrc",component:K,canActivate:[V.u6]}];let Z=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({providers:[V.u6],imports:[[A.Bz.forChild(Q)],A.Bz]}),n})();var q=a(24783),X=a(78555);let _=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({providers:[x.S],imports:[[I.ez,Z,X.W,q.m,i.UX,i.u5]]}),n})()},92718:(F,E,a)=>{a.d(E,{u:()=>B});var x=a(54004),I=a(70262),A=a(62843),b=a(87587),O=a(45682),i=a(89709),L=a(99291),D=a(3937),S=a(60991);let B=(()=>{class C{constructor(p,o,M,U,k){this.toolService=p,this.tokenService=o,this.router=M,this.ngxService=U,this.logoutService=k}canActivate(){return this.ngxService.stopAll(),!this.toolService.isTokenExpired()||this.toolService.refreshToken().pipe((0,x.U)(p=>!!p.access_token),(0,I.K)(this.handleError.bind(this)))}handleError(p){return setTimeout(()=>this.logoutService.logout()),(0,A._)(()=>p)}}return C.\u0275fac=function(p){return new(p||C)(b.LFG(O.g),b.LFG(i.B),b.LFG(L.F0),b.LFG(D.LA),b.LFG(S.P))},C.\u0275prov=b.Yz7({token:C,factory:C.\u0275fac}),C})()}}]);